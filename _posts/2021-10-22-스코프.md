---
layout: post
title: "스코프"
author: Minsun
categories: [Development]
tags: [JavaScript]
image: "assets/images/deep-dive.png"
beforetoc: ""
toc: true
---

## 스코프(Scope)

모든 식별자는 자신이 선언된 위치에 의해 자신이 유효한 범위(다른 코드에서 해당 변수를 참조할 수 있는 범위)가 결정된다. **스코프란 식별자가 유효한 범위**이다.

만약 동일한 이름을 갖는 변수를 다른 레벨 스코프에서 선언하게 되면 자바스크립트 엔진은 어떤 변수를 참조해야하는지 결정해야 하는데 이를 **식별자 결정**이라한다. 스코프는 자바스크립트 엔진이 **식별자를 검색할 때 사용하는 규칙**이라고도 할 수 있다.

### 스코프의 종류

코드는 전역과 지역으로 구분되는데 전역에서 선언된 변수는 전역 스코프를 갖는 전역 변수가 되고 지역에서 선언된 변수는 지역 스코프를 갖는 지역 변수가 된다.

전역 변수는 어디에서나 참조가 가능한 반면 지역 변수는 자신의 지역 스코프와 하위 스코프에서 유효하다.

### 스코프 체인

함수는 함수의 몸체 내부에서도 생성이 가능한데 이를 함수의 중첩이라고 한다. 함수는 중첩될 수 있기 때문에 함수의 지역 스코프도 중첩 될 수 있다. **스코프는 함수의 중첩에 의해 계층적 구조를 갖게 된다.** 이렇게 스코프가 계층적으로 연결된 것을 스코프 체인이라고 한다.

자바스크립트 엔진은 식별자를 참조 할때 스코프 체인을 통해 식별자를 참조하는 코드의 스코프에서 시작하여 **상위 스코프 방향**으로 이동하여 선언된 식별자를 검색한다. 자바스크립트 엔진은 상위 스코프 방향으로만 검색을 하기 때문에 상위 스코프에서 유효한 식별자는 하위 스코프에서 참조가 가능한 반면 하위 스코프에서 유효한 식별자는 상위 스코프에서 참조가 불가능하다.

### 함수 레벨 스코프

대부분의 프로그래밍 언어에선 모든 코드 블록(`if, for, while, try/catch`)이 지역 스코프를 만들고 이러한 특성을 **블록 레벨 스코프**한다. 하지만 `var` 키워드를 사용하여 선언된 변수는 함수의 코드 블록(함수의 몸체)만을 지역 스코프로 인정한다. 이러한 특성을 **함수 레벨 스코프**라고 한다.

`var` 키워드로 선언된 변수는 코드 블록 내에서 선언 되었을지라도 해당 블록은 지역 스코프로 인정하지 않기 때문에 전역 스코프를 갖는 전역 변수이다.

### 렉시컬 스코프

```jsx
var x = 1;

function foo() {
  var x = 10;
  //호출되는 시점이 아닌 함수 자신이 정의되었을때의 스코프를 기억한다.
  bar();
}

//bar함수는 전역에서 선언된 함수이기 때문에 전역 변수인 x를 참조하게 된다.
function bar() {
  console.log(x);
}

foo(); //내예측: 10, 실제코드: 1
bar(); //내예측: 1, 실제코드: 1
```

위의 실행 결과는 `bar` 함수의 상위 스코프가 무엇인지에 따라 결정이 된다. 프로그래밍 언어는 일반적으로 두가지 방식으로 상위 스코프를 결정하게 된다.

1. 함수를 어디에서 호출 했는지에 따라 함수의 상위 스코프를 결정한다.
2. 함수를 어디서 정의 했는지에 따라 함수의 상위 스코프를 결정한다.

1번의 방식을 **동적 스코프**라고 하는데 함수를 정의한 시점에는 어디에서 호출 될지 알 수 없기 때문에 호출되는 시점에 따라 상위 스코프를 동적으로 결정해야 되기 때문에 동적 스코프라고 한다.

2번의 방식을 **렉시컬 스코프 또는 정적 스코프**라고 한다. 스코프가 동적으로 변하지 않고 함수 정의가 평가되는 시점에 상위 스코프가 정적으로 결정되기 때문에 정적 스코프라고 한다. 자바스크립트를 포함하여 대부분의 언어에선 렉시컬 스코프를 따른다.

함수의 상위 스코프는 함수 정의가 실행 될때 정적으로 결정되며 결정된 상위 스코프를 기억하여 함수가 호출 될때마다 함수의 상위 스코프를 참조한다.
